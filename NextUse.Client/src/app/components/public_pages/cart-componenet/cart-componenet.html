<div class="container mx-auto p-4">
  <h1 class="text-2xl font-semibold mb-4">Your Cart</h1>

  <div *ngIf="loading()" class="text-center py-4">Loading...</div>
  <div *ngIf="error()" class="alert alert-danger">{{ error() }}</div>

  <div *ngIf="cart()?.status === 'CheckedOut'" class="alert alert-success text-center py-3">
    Your order is being processed
  </div>

  <!-- Show cart items only if there are items and status is not CheckedOut -->
  <ng-container *ngIf="cart() as c">
    <div *ngIf="c.items?.length && c.status !== 'CheckedOut'">
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead class="thead-light">
            <tr>
              <th>Product</th>
              <th class="text-right">Price</th>
              <th class="text-center">Count</th>
              <th class="text-right">Subtotal</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of c.items">
              <td>{{ item.title }}</td>
              <td class="text-right">{{ item.unitPrice | number:'1.2-2' }}</td>
              <td class="text-center">
                <div class="d-flex justify-content-center align-items-center gap-2">
                  <button class="btn btn-sm btn-outline-secondary" (click)="dec(item)">âˆ’</button>
                  <input
                    type="number"
                    class="form-control text-center"
                    [value]="item.quantity"
                    (change)="setQty(item, $any($event.target).value)"
                    min="1"
                    style="width: 60px;"
                  />
                  <button class="btn btn-sm btn-outline-secondary" (click)="inc(item)">+</button>
                </div>
              </td>
              <td class="text-right">{{ (item.unitPrice * item.quantity) | number:'1.2-2' }}</td>
              <td class="text-right">
                <button class="btn btn-sm btn-danger" (click)="remove(item)">Delete</button>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr class="font-weight-bold">
              <td colspan="3" class="text-right">Total</td>
              <td class="text-right">{{ total() | number:'1.2-2' }}</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-outline-secondary" (click)="clear()">Empty cart</button>
        <button class="btn btn-dark" (click)="checkout()">Checkout</button>
      </div>
    </div>

    <div *ngIf="!c.items?.length && c.status !== 'CheckedOut'" class="text-center py-4 text-muted">
      Your cart is empty
    </div>
  </ng-container>
</div>
