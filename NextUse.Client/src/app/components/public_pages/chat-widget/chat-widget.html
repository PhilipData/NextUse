<div class="chat-widget fixed bottom-4 right-4 bg-white shadow-lg rounded-2xl w-80 sm:w-96 overflow-hidden"
     *ngIf="isOpen()">
  <div class="chat-header bg-blue-600 text-white flex items-center justify-between px-4 py-2">
    <span class="text-lg font-semibold">ðŸ’¬ Chat</span>
    <button class="close-btn text-xl" (click)="toggleChat()">âœ–</button>
  </div>

  <div class="chat-users bg-gray-100 px-4 py-2">
    <p class="text-sm font-medium text-gray-700 mb-2">Chat with:</p>
    <div class="user-list flex flex-wrap gap-2">
      <button *ngFor="let user of users()"
              [ngClass]="{'active bg-blue-500 text-white': user.id === selectedUserId}"
              class="bg-gray-200 hover:bg-blue-100 text-sm py-1 px-3 rounded transition"
              (click)="selectUser(user.id)">
        {{ user.name }}
      </button>
    </div>
  </div>

  <div *ngIf="selectedUserId" class="flex flex-col h-64 px-4 py-2">
    <p class="text-sm text-gray-600 mb-1">Chatting with: {{ getSelectedUserName() }}</p>

    <div class="chat-body flex-1 overflow-y-auto space-y-2">
      <p *ngIf="messages().length === 0" class="text-center text-gray-500">No messages yet.</p>

      <div *ngFor="let msg of messages()"
          class="message flex items-start"
          [ngClass]="{'sent justify-end': msg.fromProfileId === myProfileId, 'received': msg.toProfileId === myProfileId}">
        <div class="max-w-xs p-2 rounded-lg"
             [ngClass]="{'bg-blue-500 text-white': msg.fromProfileId === myProfileId, 'bg-gray-200 text-gray-800': msg.toProfileId === myProfileId}">
          <strong *ngIf="msg.fromProfileId !== myProfileId" class="block text-xs font-medium">
            {{ msg.fromProfile?.name || 'User' }}
          </strong>
          <span class="text-sm">{{ msg.content }}</span>
        </div>
      </div>
    </div>
  </div>

  <div class="chat-footer bg-gray-100 px-4 py-2 flex items-center gap-2" *ngIf="selectedUserId">
    <input type="text"
           class="flex-1 border border-gray-300 rounded-md py-1 px-2 text-sm"
           [(ngModel)]="newMessage"
           placeholder="Type a message..."
           (keydown.enter)="sendMessage()" />
    <button class="text-blue-600 text-xl" (click)="sendMessage()">âž¤</button>
  </div>
</div>

<button class="chat-toggle fixed bottom-4 right-4 bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition"
        *ngIf="!isOpen()" (click)="toggleChat()">ðŸ’¬</button>

        